<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Monero: Compiling, debugging and testing efficiently</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Monero
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Compiling, debugging and testing efficiently </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document describes ways of compiling, debugging and testing efficiently for various use cases. The intended audience are developers, who want to leverage newly added tricks to <a class="el" href="../../d1/d5b/namespaceMonero.html">Monero</a> via <code>CMake</code>. The document will lower the entry point for these developers. Before reading this document, please consult section "Build instructions" in the main README.md. Some information from README.md will be repeated here, but the aim is to go beyond it.</p>
<h2>Basic compilation</h2>
<p><a class="el" href="../../d1/d5b/namespaceMonero.html">Monero</a> can be compiled via the main <code>Makefile</code>, using one of several targets listed there. The targets are actually presets for <code>CMake</code> calls with various options, plus <code>make</code> commands for building or in some cases <code>make test</code> for testing. It is possible to extract these <code>CMake</code> calls and modify them for your specific needs. For example, a minimal external cmake command to compile <a class="el" href="../../d1/d5b/namespaceMonero.html">Monero</a>, executed from within a newly created build directory could look like:</p>
<p><code>cmake -S "$DIR_SRC" -DCMAKE_BUILD_TYPE=Release &amp;&amp; make</code></p>
<p>where the variable <code>DIR_SRC</code> is expected to store the path to the <a class="el" href="../../d1/d5b/namespaceMonero.html">Monero</a> source code.</p>
<h2>Use cases</h2>
<h3>Test Driven Development (TDD) - shared libraries for release builds</h3>
<p>Building shared libraries spares a lot of disk space and linkage time. By default only the debug builds produce shared libraries. If you'd like to produce dynamic libraries for the release build for the same reasons as it's being done for the debug version, then you need to add the <code>BUILD_SHARED_LIBS=ON</code> flag to the <code>CMake</code> call, like the following:</p>
<p><code>cmake -S "$DIR_SRC" -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON &amp;&amp; make</code></p>
<p>A perfect use case for the above call is following the Test Driven Development (TDD) principles. In a nutshell, you'd first write a couple of tests, which describe the (new) requirements of the class/method that you're about to write or modify. The tests will typically compile for quite a long time, so ideally write them once. After you're done with the tests, the only thing left to do is to keep modifying the implementation for as long as the tests are failing. If the implementation is contained properly within a .cpp file, then the only time cost to be paid will be compiling the single source file and generating the implementation's shared library. The test itself will not have to be touched and will pick up the new version of the implementation (via the shared library) upon the next execution of the test.</p>
<h3>Project generation for IDEs</h3>
<p>CMake allows to generate project files for many IDEs. The list of supported project files can be obtained by writing in the console:</p>
<p><code>cmake -G</code></p>
<p>For instance, in order to generate Makefiles and project files for the Code::Blocks IDE, this part of the call would look like the following:</p>
<p><code>cmake -G "CodeBlocks - Unix Makefiles" (...)</code></p>
<p>The additional artifact of the above call is the <code>monero.cbp</code> Code::Blocks project file in the build directory.</p>
<h3>Debugging in Code::Blocks (CB)</h3>
<p>First prepare the build directory for debugging using the following example command, assuming, that the path to the source dir is being held in the DIR_SRC variable, and using 2 cores:</p>
<p><code>cmake -S "$DIR_SRC" -G "CodeBlocks - Unix Makefiles" -DCMAKE_BUILD_TYPE=Debug -DBUILD_TESTS=ON &amp;&amp; make -j 2</code></p>
<p>After a successful build, open the <code>monero.cbp</code> with CB. From the CB's menu bar select the target, that you want debug. Assuming these are unit tests:</p>
<p><code>Build -&gt; Select target -&gt; Select target -&gt; unit_tests</code></p>
<p>In order to lower the turnaround times, we will run a specific portion of code of interest, without having to go through all the time costly initialization and execution of unrelated parts. For this we'll use GTest's capabilities of test filtering. From the build directory run the following command to learn all the registered tests:</p>
<p><code>tests/unit_tests/unit_tests --gtest_list_tests</code></p>
<p>For example, if you're only interested in logging, you'd find in the list the label <code>logging.</code> and its subtests. To execute all the logging tests, you'd write in the console:</p>
<p><code>tests/unit_tests/unit_tests --gtest_filter="logging.*"</code></p>
<p>This parameter is what we need to transfer to CB, in order to reflect the same behaviour in the CB's debugger. From the main menu select:</p>
<p><code>Project -&gt; Set program's arguments...</code></p>
<p>Then in the <code>Program's arguments</code> textbox you'd write in this case:</p>
<p><code>--gtest_filter="logging.*"</code></p>
<p>Verify if the expected UTs are being properly executed with <code>F9</code> or select:</p>
<p><code>Build -&gt; Build and run</code></p>
<p>If everything looks fine, then after setting some breakpoints of your choice, the target is ready for debugging in CB via:</p>
<p><code>Debug -&gt; Start/Continue</code></p>
<h2>To be done (and merged):</h2>
<h3>Multihost parallel compilation</h3>
<p><a href="https://github.com/monero-project/monero/pull/7160">https://github.com/monero-project/monero/pull/7160</a></p>
<h3>Faster core_tests with caching</h3>
<p><a href="https://github.com/monero-project/monero/pull/5821">https://github.com/monero-project/monero/pull/5821</a></p>
<h3>Precompiled headers</h3>
<p><a href="https://github.com/monero-project/monero/pull/7216">https://github.com/monero-project/monero/pull/7216</a></p>
<h3>Unity builds</h3>
<p><a href="https://github.com/monero-project/monero/pull/7217">https://github.com/monero-project/monero/pull/7217</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Sep 2 2023 19:23:33 for Monero by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
