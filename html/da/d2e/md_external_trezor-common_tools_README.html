<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Monero: Common Tools</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Monero
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Common Tools </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This directory contains mostly tools that can manipulate definitions in <a href="../../../defs">defs/</a>.</p>
<p>Tools are written with <a href="http://click.pocoo.org/6/">Click</a>, so you always get a help text if you use the <code>--help</code> option.</p>
<p>All tools require Python 3.6 or higher and a bunch of dependencies, listed in <code>requirements.txt</code>. You can install them all with <code>pip3 install -r requirements.txt</code>.</p>
<h2>Tools overview</h2>
<h3><code><a class="el" href="../../dc/d86/cointool_8py.html">cointool.py</a></code></h3>
<p>This is a general-purpose tool to examine coin definitions. Currently it implements the following commands:</p>
<ul>
<li>**<code>render</code>**: generate code based on a <a href="http://docs.makotemplates.org/en/latest/index.html">Mako</a> template. By default, <code><a class="el" href="../../dc/d86/cointool_8py.html">cointool.py</a> render foo.bar.mako</code> will put its result into file <code>foo.bar</code> in the same directory. See <a href="https://github.com/trezor/trezor-core/commit/348b99b8dc5bcfc4ab85e1e7faad3fb4ef3e8763">usage in <code>trezor-core</code></a>.</li>
<li>**<code>check</code>**: check validity of json definitions and associated data. Used in CI.</li>
<li>**<code>dump</code>**: dump coin information, including support status, in JSON format. Various filtering options are available, check help for details.</li>
<li>**<code>coindefs</code>**: generate signed protobuf descriptions of coins. This is for future use and could allow us to not need to store coin data in Trezor itself.</li>
</ul>
<p>Use <code><a class="el" href="../../dc/d86/cointool_8py.html">cointool.py</a> command --help</code> to get more information on each command.</p>
<h3><code><a class="el" href="../../d0/d24/support_8py.html">support.py</a></code></h3>
<p>Used to query and manage info in <code>support.json</code>. This mainly supports the release flow.</p>
<p>The following commands are available:</p>
<ul>
<li>**<code>check</code>**: check validity of json data. Used in CI.</li>
<li>**<code>fix</code>**: fix expected problems: prune keys without associated coins and ensure that ERC20 tokens are correctly entered as duplicate.</li>
<li>**<code>show</code>**: keyword-search for a coin and show its support status for each device.</li>
<li>**<code>set</code>**: set support data.</li>
<li>**<code>release</code>**: perform the <a href="../../#release-workflow">release workflow</a>.</li>
</ul>
<p>Use <code><a class="el" href="../../d0/d24/support_8py.html">support.py</a> command --help</code> to get more information on each command.</p>
<h3><code><a class="el" href="../../d9/dbe/coins__details_8py.html">coins_details.py</a></code></h3>
<p>Generates <code>coins_details.json</code>, source file for <a href="https://trezor.io/coins">https://trezor.io/coins</a>. Collects data on coins, downloads market caps and puts everything into a single file. Caches market cap data so you don't have to download it every time.</p>
<h3><code><a class="el" href="../../d3/d0e/diffize__coins__details_8py.html">diffize_coins_details.py</a></code></h3>
<p>Compares generated <code>coins_details.json</code> to the released version currently served on <a href="https://trezor.io/coins,">https://trezor.io/coins,</a> in a format that is nicely readable to humans and hard(er) to mess up by diff.</p>
<h3><code><a class="el" href="../../d5/de4/coin__info_8py.html">coin_info.py</a></code></h3>
<p>In case where code generation with <code><a class="el" href="../../dc/d86/cointool_8py.html">cointool.py</a> render</code> is impractical or not sufficient, you can query the data directly through Python. Short usage example:</p>
<div class="fragment"><div class="line">import coin_info</div><div class="line"></div><div class="line">defs = coin_info.coin_info()</div><div class="line">list_of_all_coins = defs.as_list()</div><div class="line">dict_by_coin_key = defs.as_dict()</div><div class="line"></div><div class="line">for token in defs.erc20:</div><div class="line">    print(token[&quot;key&quot;], token[&quot;name&quot;], token[&quot;shortcut&quot;])</div><div class="line"></div><div class="line">support_info = coin_info.support_info(defs.misc)</div><div class="line">for key, support in support_info.values():</div><div class="line">    t2_support = support[&quot;trezor2&quot;]</div><div class="line">    coin_name = dict_by_coin_key[key]</div><div class="line">    if t2_support == &quot;soon&quot;:</div><div class="line">        print(coin_name, &quot;will be supported soon!&quot;)</div><div class="line">    elif t2_support:</div><div class="line">        print(coin_name, &quot;is supported since version&quot;, t2_support)</div><div class="line">    else:</div><div class="line">        print(coin_name, &quot;is not supported&quot;)</div></div><!-- fragment --><p>See docstrings for the most important functions: <code><a class="el" href="../../d7/d0b/namespacecoin__info.html#adde899607766b8606329ffea0d5f4e42">coin_info()</a></code> and <code><a class="el" href="../../d7/d0b/namespacecoin__info.html#a16b44dc5bf1618957539778208e197b4">support_info()</a></code>.</p>
<p>The file <code><a class="el" href="../../d0/dfd/coindef_8py.html">coindef.py</a></code> is a protobuf definition for passing coin data to Trezor from the outside.</p>
<h1>Release Workflow</h1>
<p>This entails collecting information on coins whose support status is unknown, marking coins whose support status is <code>soon</code>, and including new ERC20 tokens.</p>
<h2>Maintaining Support Status</h2>
<p>When a new coin definition is added, its support status is <em>unknown</em>. It is excluded from code generation by default. If you want to include a coin in a firmware build, you need to switch it to <em>soon</em> first. You can set multiple support statuses at the same time:</p>
<div class="fragment"><div class="line">$ ./support.py show Ontology</div><div class="line">misc:ONT - Ontology (ONT)</div><div class="line"> * connect : NO</div><div class="line"> * trezor1 : support info missing</div><div class="line"> * trezor2 : support info missing</div><div class="line"> * webwallet : NO</div><div class="line"></div><div class="line">$ ./support.py set misc:ONT trezor1=no -r &quot;not planned on T1&quot; trezor2=soon</div><div class="line">misc:ONT - Ontology (ONT)</div><div class="line"> * connect : NO</div><div class="line"> * trezor1 : NO (reason: not planned on T1)</div><div class="line"> * trezor2 : SOON</div><div class="line"> * webwallet : NO</div></div><!-- fragment --><p>Afterwards, review and commit changes to <code>defs/support.json</code>, and update the <code>trezor-common</code> submodule in your target firmware.</p>
<p>If you're adding multiple coins at once, you can use <code><a class="el" href="../../d0/d24/support_8py.html">support.py</a> release 1 --soon</code> to automatically add all currently-unknown coins to <em>soon</em>. (The <code>1</code> indicates that this is for Trezor One)</p>
<p>ERC20 tokens in <em>unknown</em> state are considered <em>soon</em> as well, unless their symbols are duplicates. Use <code><a class="el" href="../../d0/d24/support_8py.html">support.py</a> fix</code> to synchronize duplicate status in <code>support.json</code> file. Or mark them as unsupported explicitly.</p>
<h2>Releasing a new firmware</h2>
<h4>**Step 1:** update the tokens repo</h4>
<div class="fragment"><div class="line">pushd defs/ethereum/tokens</div><div class="line">git checkout master</div><div class="line">git pull</div><div class="line">popd</div><div class="line">git add defs/ethereum/tokens</div></div><!-- fragment --><h4>**Step 2:** run the release flow</h4>
<div class="fragment"><div class="line">./tools/support.py release 2</div></div><!-- fragment --><p>The number <code>2</code> indicates that you are releasing Trezor 2. The version will be automatically determined, based on currently released firmwares. Or you can explicitly specify the version with <code>-r 2.1.0</code>.</p>
<p>All currently known unreleased ERC20 tokens are automatically set to the given version.</p>
<p>All coins marked <em>soon</em> are set to the current version. This is automatic - coins that were marked <em>soon</em> were used in code generation and so should be released. If you want to avoid this, you will have to manually revert each coin to <em>soon</em> status, either with <code><a class="el" href="../../d0/d24/support_8py.html">support.py</a> set</code>, or by manually editing <code>support.json</code>.</p>
<p>Coins in state <em>unknown</em>, i.e., coins that are known in the definitions but not listed in support files, will be also added. But you will be interactively asked to confirm each one. Use <code>-y</code> or <code>--add-all</code> to auto-add all of them.</p>
<p>Use <code>-n</code> or <code>--dry-run</code> to see changes without writing them to <code>support.json</code>. Use <code>-v</code> or <code>--verbose</code> to also show ERC20 tokens which are processed silently by default.</p>
<p>Use <code>-g</code> or <code>--git-tag</code> to automatically tag the current <code>HEAD</code> with a version, e.g., <code>trezor2-2.1.0</code>. This might become default in the future.</p>
<p>XXX this should also commit the changes though, otherwise the tag will apply to the wrong commit.</p>
<h4>**Step 3:** review and commit your changes</h4>
<p>Use <code>git diff</code> to review changes made, commit and push. If you tagged the commit in the previous step, don't forget to <code>git push --tags</code> too.</p>
<h4>**Step 4:** update submodule in your target repository</h4>
<p>Go to <code>trezor-core</code> or <code>trezor-mcu</code> checkout and update the submodule. Checkout the appropriate tag if you created it. If you're in <code>trezor-core</code>, run <code>make templates</code> to update source files. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Sep 2 2023 19:23:34 for Monero by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
