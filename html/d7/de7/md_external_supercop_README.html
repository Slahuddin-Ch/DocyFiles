<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Monero: Supercop</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Monero
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Supercop </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p>This project could use a rename :/ </p>
</blockquote>
<p>The objective of this project is to provide fast cryptographic operations for <a class="el" href="../../d1/d5b/namespaceMonero.html">Monero</a> wallets. Unfortunately, there isn't necessarily a single fastest library for all platforms - donna64 for instance likely performs poorly when cross-compiled to asm.js or 32-bit arm. This project mitigates this issue by copying the cryptographic libraries with as little changes as possible (ideally zero), and then provides smaller and easier to audit "glue" functions that use the cryptographic library to perform typical <a class="el" href="../../d1/d5b/namespaceMonero.html">Monero</a> wallet tasks. These "glue" functions are often not obvious to the typical developer (otherwise they would be using the cryptographic libraries already), however auditing these functions should be straightforward to anyone familar with how the cryptography works.</p>
<p>The project is also designed to be used in-tree in other projects or installable on a system. The default <a class="el" href="../../d1/d5b/namespaceMonero.html">Monero</a> wallets use the in-tree implementation which serve as a more complex example of its usage. The project directory structure:</p>
<ul>
<li><b>crypto_sign</b> - whose name is taken from supercop. The code in here is from upstream cryptographic libraries with minimal changes (position independent ASM).</li>
<li><b>include</b> - The only files that should be included by external projects, with the exception of the auto-generated header.</li>
<li><b>src</b> - Contains all of the glue functions and build code.</li>
<li><b>functions.cmake</b> - The raw components for building the library. Used by the default <a class="el" href="../../d1/d5b/namespaceMonero.html">Monero</a> wallet.</li>
<li><b>intree.cmake</b> - Creates a cmake library target <code>monero-crypto-intree</code> and generates a header at <code>&lt;BUILD_LOCATION&gt;/include/monero/crypto.h</code>.</li>
<li><b>CMakeLists.txt</b> - Declares a new project for creating/installing a shared or static <code>monero-crypto</code> library.</li>
</ul>
<blockquote class="doxtable">
<p>Downstream projects cannot currently use this project <em>without</em> also using the <code>monero-project/monero/src/crypto/crypto.h</code> functions - specifically <code><a class="el" href="../../de/d36/namespacecrypto.html#afb4ba722c59e935c7a15d81f93c1560c">crypto::derivation_to_scalar</a></code>. So currently this project provides performance enhancements but not standalone usage. </p>
</blockquote>
<h2>Usage</h2>
<p>Every cryptographic library implements the same function signatures but with unique namespaces to avoid collisions in the C symbol table. Downstream projects can either use a specific library and header file OR dynamically select a library and use a cmake generated header that uses macro replacement to reference the selected library. Since each library has unique symbol names, multiple can be used simulatenously (benchmarking, etc).</p>
<h2>C Wallet Functions</h2>
<p>Every cryptographic library implements:</p>
<ul>
<li>**<code>monero_crypto_&lt;namespace&gt;_scalarmult(char* out, const char* pub, const char* sec)</code>** - where <code>out</code> is the shared secret, <code>pub</code> is an ed25519 public key, and <code>sec</code> is a user secret key. This operation is a standard ECDH operation on the ed25519 curve.</li>
<li>**<code>monero_crypto_&lt;namespace&gt;_generate_key_derivation(char* out, const char* tx_pub, const char* view_sec)</code>** - where <code>out</code> is the shared secret, <code>tx_pub</code> is the public key from the transaction and <code>view_sec</code> is the users view-key secret.</li>
<li>**<code>monero_crypto_&lt;namespace&gt;_generate_subaddress_public_key(char* out, const char* output_pub, const char* special_sec)</code>** - where <code>out</code> is the computed spend-public (primary or subaddress), <code>output_pub</code> is the public key from the transaction output, and <code>special_sec</code> is the output from <code><a class="el" href="../../de/d36/namespacecrypto.html#afb4ba722c59e935c7a15d81f93c1560c">crypto::derivation_to_scalar</a></code> (which is given the shared secret from <code>generate_key_derivation</code>).</li>
</ul>
<p>All <code>char</code> pointers must be exactly 32-bytes. The auto-generated header has an empty namespace for these functions and uses macro replacement to forward to the selected library. If using dynamically selected libraries, include the auto-generated header and use <code>monero_crypto_generate_key_derivation</code>, etc.</p>
<h2>CMake Usage</h2>
<h3>Explicit Library Usage</h3>
<p>A library can be selected explicitly in-tree:</p>
<div class="fragment"><div class="line">include(supercop/functions.cmake)</div><div class="line">monero_crypto_get_target(&quot;amd64-64-24k&quot; CRYPTO_TARGET)</div><div class="line"></div><div class="line">add_library(all $&lt;OBJECT_TARGETS:${CRYPTO_TARGET}&gt; all.cpp)</div><div class="line">add_library(referenced referenced.cpp)</div><div class="line">target_link_libraries(referenced ${CRYPTO_TARGET})</div></div><!-- fragment --><p>The <code>all</code> library will have all C functions in the <code>amd64-64-24k</code> library whereas the <code>referenced</code> library will only have C functions referenced in <code>referenced.cpp</code>.</p>
<h2>Basic In-Tree Dynamic Usage</h2>
<p>A library can be selected at build time in-tree:</p>
<div class="fragment"><div class="line">include(supercop/intree.cmake)</div><div class="line"></div><div class="line">add_library(all $&lt;OBJECT_TARGETS:monero-crypto-intree&gt; all.cpp)</div><div class="line">add_library(referenced referenced.cpp)</div><div class="line">target_link_libraries(referenced monero-crypto-intree)</div></div><!-- fragment --><p>The best available library for the target platform is selected which can be overriden with <code>-DMONERO_CRYPTO_LIBRARY=amd64-51-30k</code> or by setting the variable with the same name.</p>
<p>A header file is written to <code>&lt;BUILD_LOCATION&gt;/include/monero/crypto.h</code> which contains empty namespace macros that expand to the <a href="../../#c-wallet-functions">wallet functions</a> for the selected library. Including this header file and using the empty namespace macros will allow for the crypto library to be selected dynamically.</p>
<p>See the <a href="../../#explicit-library-usage">explicit usage section</a> for the difference between the <code>all</code> and <code>referenced</code> libraries.</p>
<h2>Advanced In-Tree Dynamic Usage</h2>
<p>See <code>intree.cmake</code> on how to use the individual cmake functions in your project for more control. Each of the cmake functions is documented.</p>
<h2>Standalone Usage</h2>
<p>Is not-yet fully functional since the <code><a class="el" href="../../de/d36/namespacecrypto.html#afb4ba722c59e935c7a15d81f93c1560c">crypto::derivation_to_scalar</a></code> from the <a class="el" href="../../d1/d5b/namespaceMonero.html">Monero</a> source tree is still needed. However this is a proof-of-concept that will be useful for testing if your project does not use cmake.</p>
<p>Running <code>cmake &lt;source_path&gt; . &amp;&amp; make &amp;&amp; sudo make install</code> will autodetect the best crypto library, build it in the current directory, and then install to the default location for your system. An error is generated if your target platform does not have a supported crypto library. The auto-selected library can be overriden with <code>-DMONERO_CRYPTO_LIBRARY=amd64-51-30k</code> at the first cmake step. Using <code>-DMONERO_CRYPTO_LIBRARY=invalid</code> will generate an error that displays all available crypto libraries. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Sep 2 2023 19:23:34 for Monero by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
